<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>新产品失败成本率TOP5</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=316" media="all"/>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- 加载动画 -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>
<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">
            <i class="layui-icon layui-icon-tabs"></i>
            <span><span id="month"></span>新产品失败成本率TOP5</span>
        </div>
        <div class="layui-card-body">

            <div class="layui-row">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span>IA</span>
                        </div>
                        <div class="layui-card-body">
                            <!-- 数据表格 -->
                            <table id="dataTableIA" lay-filter="dataTableIA"></table>
                        </div>
                    </div>
                </div>

                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span>IT</span>
                        </div>
                        <div class="layui-card-body">
                            <!-- 数据表格 -->
                            <table id="dataTableIT" lay-filter="dataTableIT"></table>
                        </div>
                    </div>
                </div>

                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <span>MD</span>
                        </div>
                        <div class="layui-card-body">
                            <!-- 数据表格 -->
                            <table id="dataTableMD" lay-filter="dataTableMD"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=316"></script>
<script>
    layui.use(['table', 'notice', 'form', 'notice', 'tableX'], function () {
        var table = layui.table;
        var form = layui.form;
        var $ = layui.$;
        var notice = layui.notice;
        var tableX = layui.tableX;

        var getQueryVariable = function (variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] === variable){return pair[1];}
            }
            return(false);
        };

        var month = getQueryVariable("month");
        $("#month").html(month);

        table.render({
            title: "编号",
            elem: '#dataTableIA',
            size: 'sm',
            data: [],
            cols: [[
                {type: 'numbers'},
                {title: '机种',  align: 'center', templet: function(d) {
                        return '<a target="_blank" style="color: #01AAED" href="/page/newReport3.html?project='+d.project+'">'+d.project+'</a>';
                    }},
                {title: '内损费用', field: 'in_loss_cost',  align: 'center', templet: function(d){return numFormat(d.in_loss_cost)}},
                {title: '外损费用', field: 'out_loss_cost',  align: 'center', templet: function(d){return numFormat(d.out_loss_cost)}},
                {title: '鉴定费用', field: 'identity_cost',  align: 'center', templet: function(d){return numFormat(d.identity_cost)}},
                {title: '预防费用', field: 'prevention_cost',  align: 'center', templet: function(d){return numFormat(d.prevention_cost)}},
                {title: '比率', field: 'rate',  align: 'center', templet: function(d) {
                        return d.rate.toFixed(3)+'%';
                    }
                }
            ]]
            ,limit: 5
        });

        table.render({
            title: "编号",
            elem: '#dataTableIT',
            size: 'sm',
            data: [],
            cols: [[
                {type: 'numbers'},
                {title: '机种',  align: 'center', templet: function(d) {
                        return '<a target="_blank" style="color: #01AAED" href="/page/newReport3.html?project='+d.project+'">'+d.project+'</a>';
                    }},
                {title: '内损费用', field: 'in_loss_cost',  align: 'center'},
                {title: '外损费用', field: 'out_loss_cost',  align: 'center'},
                {title: '鉴定费用', field: 'identity_cost',  align: 'center'},
                {title: '预防费用', field: 'prevention_cost',  align: 'center'},
                {title: '比率', field: 'rate',  align: 'center', templet: function(d) {
                        return d.rate.toFixed(3)+'%';
                    }
                }
            ]]
            ,limit: 5
        });

        table.render({
            title: "编号",
            elem: '#dataTableMD',
            size: 'sm',
            data: [],
            cols: [[
                {type: 'numbers'},
                {title: '机种',  align: 'center', templet: function(d) {
                        return '<a target="_blank" style="color: #01AAED" href="/page/newReport3.html?project='+d.project+'">'+d.project+'</a>';
                    }},
                {title: '内损费用', field: 'in_loss_cost',  align: 'center'},
                {title: '外损费用', field: 'out_loss_cost',  align: 'center'},
                {title: '鉴定费用', field: 'identity_cost',  align: 'center'},
                {title: '预防费用', field: 'prevention_cost',  align: 'center'},
                {title: '比率', field: 'rate',  align: 'center', templet: function(d) {
                        return d.rate.toFixed(3)+'%';
                    }
                }
            ]]
            ,limit: 5
        });

        $.get('/npFailureCostRate/getDetail', {month: month}, function(d) {
            var d1_ia = [];
            var d2_it = [];
            var d3_md = [];
            for(var i=0; i<d.data.length; i++) {
                var obj = d.data[i];
                if(obj.type && obj.type.indexOf("IA")>-1) {
                    d1_ia.push(obj);
                }
                if(obj.type && obj.type.indexOf("IT")>-1) {
                    d2_it.push(obj);
                }
                if(obj.type && obj.type.indexOf("MD")>-1) {
                    d3_md.push(obj);
                }
            }
            table.reload('dataTableIA', {data: d1_ia});
            table.reload('dataTableIT', {data: d2_it});
            table.reload('dataTableMD', {data: d3_md});
        });

        var numFormat = function(num) {
            return (num.toString().indexOf ('.') !== -1) ?
                num.toLocaleString() : num.toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,');
        };
    });
</script>
</body>
</html>